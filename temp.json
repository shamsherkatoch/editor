{
    "apiVersion": "2017-05-10",
    "name": "DNSARecord",
    "type": "Microsoft.Resources/deployments",
    "resourceGroup": "<resourcegroup-where-the-dns-zone-lives>",
    "subscriptionId": "<subscription-where-the-dns-zone-lives>",
    "dependsOn": [
        "[variables('privateEndpointName')]"
    ],
    "properties": {
        "mode": "Incremental",
        "expressionEvaluationOptions": {
            "scope": "inner"
        },
        "parameters": {
            "recordName": {
                "value": "[variables('keyVaultName')]"
            },
            "NetworkInterfaceId": {
                "value": "[reference(variables('privateEndpointName')).networkInterfaces[0].id]"
            }
        },
        "template": {
            "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json",
            "contentVersion": "1.0.0.0",
            "parameters": {
                "recordName": {
                    "type": "string"
                },
                "NetworkInterfaceId": {
                    "type": "string"
                }
            },
            "resources": [
                {
                    "type": "Microsoft.Network/privateDnsZones/A",
                    "apiVersion": "2018-09-01",
                    "name": "[concat('privatelink.vaultcore.azure.net', '/', parameters('recordName'))]",
                    "properties": {
                        "ttl": 30,
                        "aRecords": [
                            {
                                "ipv4Address": "[reference(parameters('NetworkInterfaceId'), '2020-05-01', 'Full').properties.ipConfigurations[0].properties.privateIPAddress]"
                            }
                        ]
                    }
                }
            ]
        }
    }
}
