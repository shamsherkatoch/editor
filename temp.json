{
    "type": "Microsoft.KeyVault/vaults",
    "apiVersion": "2019-09-01",
    "name": "[variables('keyVaultName')]",
    "location": "[variables('location')]",
    "properties": {
        "tenantId": "[variables('tenantid')]",
        "sku": {
            "name": "standard",
            "family": "A"
        },
        "enabledForDeployment": false,
        "enabledForDiskEncryption": false,
        "enabledForTemplateDeployment": true,
        "enableSoftDelete": true,
        "accessPolicies": "[variables('accessPolicies')]"
    }
},
{
    "type": "Microsoft.Network/privateEndpoints",
    "apiVersion": "2020-05-01",
    "name": "[variables('privateEndpointName')]",
    "location": "[variables('location')]",
    "dependsOn": [
        "[variables('keyVaultName')]"
    ],
    "properties": {
        "subnet": {
            "id": "[resourceId(parameters('virtualNetworkResourceGroupName'), 'Microsoft.Network/virtualNetworks/subnets', parameters('virtualNetworkName'), parameters('subnetName'))]"
        },
        "privateLinkServiceConnections": [
            {
                "name": "[variables('privateEndpointName')]",
                "properties": {
                    "privateLinkServiceId": "[resourceId('Microsoft.KeyVault/vaults', variables('keyVaultName'))]",
                    "groupIds": [
                        "vault"
                    ]
                }
            }
        ]
    }
},
{
    "type": "Microsoft.Network/privateDnsZones/A",
    "apiVersion": "2018-09-01",
    "name": "[concat('privatelink.vaultcore.azure.net', '/', variables('keyVaultName'))]",
    "properties": {
        "ttl": 30,
        "aRecords": [
            {
                "ipv4Address": "[reference(variables('privateEndpointName'), '2020-05-01', 'Full').networkInterfaces[0].properties.ipConfigurations[0].properties.privateIPAddress]"
            }
        ]
    }
}
